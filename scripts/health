#!/usr/bin/env bash
set -uo pipefail

if [[ -f .env ]]; then
  set -a
  source .env
  set +a
fi

function check() {
  local port="$1"
  local label="$2"
  echo "== ${label} :${port} =="
  if response=$(curl -sf --connect-timeout 3 --max-time 5 "http://127.0.0.1:${port}/v1/models" 2>&1); then
    echo "$response" | head -c 400
  else
    echo "(not responding)"
  fi
  echo ""
}

check "${ORCH_PORT:-8001}" "Tier 1 Orchestrator (vLLM)"
check "${CODER_PORT:-8002}" "Tier 2 Coder (vLLM)"
check "${REVIEWER_PORT:-8011}" "Tier 3 Reviewer (llama.cpp)"
check "${UTILITY_PORT:-8012}" "Tier 0 Utility (llama.cpp)"
