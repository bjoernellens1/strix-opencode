#!/usr/bin/env bash
set -uo pipefail

if [[ -f .env ]]; then
  set -a
  source .env
  set +a
fi

function check() {
  local port="$1"
  local label="$2"
  echo "== ${label} :${port} =="
  if response=$(curl -sf --connect-timeout 3 --max-time 5 "http://127.0.0.1:${port}/v1/models" 2>&1); then
    echo "$response" | head -c 400
  else
    echo "(not responding)"
  fi
  echo ""
}

# Phase 5 hybrid: llama.cpp for Thor/Valkyrie/Odin, vLLM BF16 for Heimdall/Loki/Frigga
check "${THOR_PORT:-8001}" "Thor âš¡ Primary Commander (llama.cpp GPU, GGUF)"
check "${VALKYRIE_PORT:-8002}" "Valkyrie ðŸ›¡ Execution Specialist (llama.cpp GPU, GGUF)"
check "${ODIN_PORT:-8011}" "Odin ðŸ‘ï¸ Supreme Architect (llama.cpp GPU, GGUF)"
check "${HEIMDALL_PORT:-8012}" "Heimdall ðŸ‘ Guardian (vLLM GPU, BF16)"
check "${LOKI_PORT:-8013}" "Loki ðŸ§  Adversarial Intelligence (vLLM GPU, BF16)"
check "${FRIGGA_PORT:-8014}" "Frigga ðŸŒ¿ Knowledge Curator (vLLM GPU, BF16)"

# Bifrost scheduler (hybrid mode)
BIFROST_PORT="${BIFROST_PORT:-8899}"
echo "== Bifrost Scheduler :${BIFROST_PORT} =="
if response=$(curl -sf --connect-timeout 3 --max-time 5 "http://127.0.0.1:${BIFROST_PORT}/v1/status" 2>&1); then
  echo "$response" | python3 -m json.tool 2>/dev/null || echo "$response" | head -c 600
else
  echo "(not responding)"
fi
echo ""
